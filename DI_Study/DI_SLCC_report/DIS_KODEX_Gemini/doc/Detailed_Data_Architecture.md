# 상세 데이터 아키텍처 및 수집 전략 (Detailed Data Architecture & Collection Strategy)

## 1. 개요 (Overview)
본 문서는 KODEX 마케팅 인텔리전스 프로젝트의 데이터 기반을 구축하기 위한 **상세 데이터 아키텍처**를 정의합니다. 기존 아키텍처를 기반으로, 5대 핵심 채널(유튜브, 커뮤니티, 네이버, SNS, 홈페이지)의 특성을 반영하여 **수집-가공-분석** 전 과정의 데이터 흐름을 구체화하는 것을 목표로 합니다.

---

## 2. 통합 데이터 아키텍처 (Integrated Data Architecture)
데이터는 **Raw(Bronze) -> Processed(Silver) -> Analysis(Gold)**의 3단계 레이어로 관리되며, 각 단계는 채널별 특성을 반영하여 상세화됩니다.

### 2.1 Layer 1: Raw Data (Bronze) - "있는 그대로 보존"
- **목적**: 원본 데이터의 무결성 보존 및 재처리를 위한 기반 마련.
- **저장 방식**: 파일 시스템 (JSON, HTML, 이미지 등)
- **상세 구조**:
  ```text
  /data/raw/
  ├── youtube/
  │   ├── video_meta/     # 영상 메타 정보
  │   ├── comments/       # 댓글
  │   └── transcripts/    # 스크립트
  ├── community/
  │   ├── dcinside/       # 디시인사이드
  │   ├── fmkorea/        # 에펨코리아
  │   └── naver_cafe/     # 네이버 카페
  ├── naver/
  │   ├── search_trend/   # 검색어 트렌드
  │   └── blog_posts/     # 블로그 포스트
  ├── sns/
  │   ├── facebook/
  │   ├── instagram/
  │   └── twitter/
  └── websites/
      ├── kodex/          # 자사 홈페이지
      └── tiger/          # 경쟁사 홈페이지
  ```

### 2.2 Layer 2: Processed Data (Silver) - "구조화 및 정제"
- **목적**: 분석에 용이한 정형 데이터(테이블)로 변환.
- **저장 방식**: RDBMS (PostgreSQL) 또는 DuckDB.
- **주요 테이블 정의**:
  - `TB_YOUTUBE_VIDEOS`: 유튜브 영상 정보 (채널명, 제목, 조회수, 좋아요, 업로드일)
  - `TB_YOUTUBE_COMMENTS`: 유튜브 댓글 정보 (영상ID, 작성자, 내용, 작성일)
  - `TB_COMMUNITY_POSTS`: 커뮤니티 게시글 (출처, 제목, 내용, 작성자, 작성일, 조회수, 좋아요)
  - `TB_NAVER_SEARCH_TREND`: 네이버 검색어 트렌드 (키워드, 날짜, 검색량, 연관검색어)
  - `TB_SNS_POSTS`: 소셜미디어 포스트 (채널, 작성자, 내용, 해시태그, 공유수, 인용수)
  - `TB_WEBSITE_EVENTS`: 경쟁사 이벤트 및 공지사항 (출처, 제목, 등록일, 내용)

### 2.3 Layer 3: Analysis Mart (Gold) - "가설 검증용 지표"
- **목적**: 7대 가설 검증 및 KPI 측정을 위한 집계 데이터.
- **주요 마트 정의**:
  - `MART_SOV_TREND`: 채널별/키워드별 검색 점유율(SOV) 추이
  - `MART_COMMUNITY_SENTIMENT`: 커뮤니티별/제품별 일간 감성 점수
  - `MART_SNS_BUZZ_VOLUME`: SNS 채널별 버즈량 및 언급량 추이
  - `MART_INFLUENCER_IMPACT`: 인플루언서별 평균 조회수, 댓글 반응률, 감성 점수
  - `MART_COMPETITOR_ACTIVITY`: 경쟁사 마케팅 활동(이벤트, 신규상품) 빈도 및 내용

---

## 3. 채널별 상세 수집 설계 (Detailed Collection Design)

### 3.1 유튜브 (YouTube)
- **대상**: 자사/경쟁사/주요 인플루언서 채널의 영상, 댓글, 스크립트
- **수집 필드**: `영상제목`, `조회수`, `좋아요`, `댓글내용`, `구독자수`, `영상설명`, `스크립트`
- **수집 주기**: **일(Daily)**
- **기술 전략**: `yt-dlp`와 `Playwright`를 병행. `yt-dlp`로 메타/댓글/자막을 고속 수집하고, Playwright로 채널 페이지의 영상 목록(1년치)을 스크롤하며 수집 대상을 확보.
- **활용 지표**: 인플루언서 반응 패턴, 콘텐츠 주제별 투자자 행동 분석, 영상 길이 대비 시청 시간 분석.

### 3.2 커뮤니티 (Community)
- **대상**: 주식 종목토론방, 디시인사이드(미국주식 갤러리 등), 네이버 카페(미주미 등), 에펨코리아(주식/투자 게시판)
- **수집 필드**: `게시글 제목`, `본문`, `댓글`, `좋아요/추천수`, `작성일`, `작성자`
- **수집 주기**: **주(Weekly)** - 단, 주요 이벤트 발생 시 일 단위 수집으로 전환
- **기술 전략**: `Scrapy`를 활용한 정적/반정적 페이지 고속 크롤링. 로그인 필요한 경우 Playwright로 세션 관리. User-Agent 및 IP 로테이션으로 차단 회피.
- **활용 지표**: 토픽 트렌드(LDA), 감성분석(긍/부정), KODEX vs TIGER 언급 비율, 팬덤 형성 지표.

### 3.3 네이버 (Naver)
- **대상**: 네이버 통합검색, VIEW(블로그/카페), 연관검색어, 검색량 트렌드
- **수집 필드**: `핵심키워드`, `연관검색어`, `월간검색량`, `블로그 포스팅 본문`, `이미지/도표`, `댓글`
- **수집 주기**: **주(Weekly)**
- **기술 전략**: 네이버 검색은 UI가 자주 바뀌므로 CSS Selector와 XPath를 혼용. 블로그는 `iframe` 구조에 대응. 검색량은 `네이버 데이터랩` API 또는 크롤링으로 수집.
- **활용 지표**: 핵심 키워드 검색 점유율(SOV), 키워드 클러스터링, 블로그 내 상품 인용 횟수.

### 3.4 SNS
- **대상**: 인스타그램, 페이스북, 트위터(X) 내 관련 해시태그 및 공식 계정
- **수집 필드**: `포스팅 본문`, `이미지/영상`, `해시태그`, `댓글`, `공유(인용)`
- **수집 주기**: **일(Daily)**
- **기술 전략**: 각 플랫폼의 비공식 API 또는 라이브러리(`instaloader`, `facebook-scraper`)를 우선 활용. 제약 심할 경우 Playwright 기반으로 최소한의 데이터(버즈량, 텍스트) 수집.
- **활용 지표**: 상품/브랜드 언급량, 감성 지수, 콘텐츠 확산 경로 추적.

### 3.5 홈페이지 (Websites)
- **대상**: 삼성자산운용, 미래에셋자산운용 등 주요 경쟁사 ETF 소개 및 이벤트 페이지
- **수집 필드**: `ETF 포트폴리오`, `이벤트 공지`, `투자정보 콘텐츠`, `개인순매수 데이터`
- **수집 주기**: **일(Daily) / 주(Weekly)** - 페이지 중요도에 따라 차등 적용
- **기술 전략**: 대부분 정적 페이지이므로 `Scrapy`를 기본으로 사용. 변경 이력을 추적하기 위해 페이지 전체 HTML을 주기적으로 저장하고 `diff`로 변경 사항 감지.
- **활용 지표**: 경쟁사 마케팅 활동(이벤트, 보도자료), 신규 상품 출시 및 포트폴리오 변경 추적.
